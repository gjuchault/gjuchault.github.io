[{"body":"<p>During my internship in <a href=\"http://bettercollective.com\">BetterCollective</a> I&#39;ve had the chance to try out <a href=\"https://dev.botframework.com/\">Microsoft Bot</a> during a demo day —a day where everyone can try out anything and make a demo at the end of they day—. I also used <a href=\"https://luis.ai\">LUIS</a> to recognize sentences.</p>\n<p>Here is my review.</p>\n<h2 id=\"context\">Context</h2>\n<p>I&#39;m working in BetterCollective. I&#39;m in the new <a href=\"https://bettingexpert.com\">BettingExpert</a> team working on the frontend. One of the goals of this website is to list some tips —that others from BettingExpert has made— you can click to be redirected on tipping bookmakers.</p>\n<h2 id=\"creating-a-luis-application\">Creating a LUIS application</h2>\n<p>Even if in all tutorials people start building using Microsoft Bot, I&#39;ve started by testing out LUIS <em>Language Understanding Intelligent Service</em>.\nAs in all AI services, you start by creating entities: parameters to your sentences that the user will make. So I started to create a small English LUIS application from scratch and created an entity &quot;Bookmaker&quot;. Then, what you need to do is define &quot;intents&quot;. Theses are action that your user can do talking to the bot.</p>\n<p>Creating an intent is easy: give it a title, give it an example and there you go. So let&#39;s start the new intent: &quot;showBonusCodes&quot; with the exmaple: &quot;Can you list bet365 bonuscodes?&quot;. Optionnaly, you can add parameters. I added one, called &quot;bookmaker&quot;, which is an entity of my entity &quot;Bookmaker&quot;.</p>\n<p>Nothing genius here.</p>\n<p><img src=\"/dist/luis1.png\" alt=\"Adding intent\"></p>\n<p>Alternatively you can add pre-built entities that doesn&#39;t need training: RegExps and PreBuilt Entities (number, datetime, dimension, etc.).</p>\n<p>Then you start to type possible sentences (called &quot;utterences&quot;) and train your bot. If it does not recognize the sentence, just set the intent in the list and select the entity. Then train your bot again and there you go.</p>\n<p><img src=\"/dist/luis2.png\" alt=\"Adding utterences\"></p>\n<p>A few other options are available: review all utterences ever submitted to your bot, filter by the one it didn&#39;t recognize, etc.</p>\n<p>LUIS exposes a link for testing purposes and answers JSON, which is great.</p>\n<p><img src=\"/dist/luis3.png\" alt=\"JSON API\"></p>\n<h3 id=\"a-few-things\">A few things</h3>\n<ul>\n<li>You can&#39;t add two number prebuilt entities (and you can&#39;t add two parameters to the intent with the same entity or prebuilt entity).</li>\n<li>You can&#39;t convert a string number to number (if you try a prebuilt entity &quot;number&quot; and input &quot;ten thousand&quot;, the API will recognize the number but not convert it to an actual number —which is strange because it does work for dates—).</li>\n</ul>\n<h2 id=\"using-your-luis-application-into-microsoft-bot\">Using your LUIS application into Microsoft Bot</h2>\n<p>Microsoft Bot is a service and a Node (or C#) library that allows you to create a REST API to make a bot. I&#39;ve not been using this a lot, and I have only been playing with one endpoint (<code>/</code>). You&#39;re supposed to use endpoints for the different usage of your bot.\nI&#39;ve also failed to use the LUIS integrated connector, so I went with a request library (the awesome <a href=\"https://github.com/mzabriskie/axios\">axios</a>) and used the REST API LUIS provides (a simple GET query).</p>\n<p>I also used the Microsoft Bot Connector to make a Facebook Page and Application running the bot using webhooks so that users can speak to my bot from Facebook/Messenger.</p>\n<p>Microsoft provides a step-by-step tutorial which is really cool. You&#39;re quickly set up.</p>\n<p>I also was able to use an alternative artificial intelligence to LUIS: <a href=\"https://api.ai/\">api.ai</a> so that my company would choose which service they find best. It has the same functionnalities globaly (intents, entities, utterences, etc.).</p>\n<p>My project looked like this: <em>index.js</em> creates the server, handle the service you want to use through a command option, and when the user sends a message, it use a dispatcher (<em>dispatcher.luis.js</em> or <em>dispatcher.apiai.js</em>) that sends the request, get the answer and extract a JSON like that:</p>\n<pre><code class=\"hljs json\">{\n    <span class=\"hljs-attr\">\"intent\"</span>: <span class=\"hljs-string\">\"showBonusCodes\"</span>,\n    <span class=\"hljs-attr\">\"query\"</span>: <span class=\"hljs-string\">\"Can you list bet365 bonuscodes?\"</span>,\n    <span class=\"hljs-attr\">\"parameters\"</span>: {\n        <span class=\"hljs-attr\">\"bookmaker\"</span>: <span class=\"hljs-string\">\"bet365\"</span>\n    }\n}\n</code></pre>\n<p>Or</p>\n<pre><code class=\"hljs json\">{\n    <span class=\"hljs-attr\">\"intent\"</span>: <span class=\"hljs-string\">\"showBonusCodes\"</span>,\n    <span class=\"hljs-attr\">\"query\"</span>: <span class=\"hljs-string\">\"Can you list bonuscodes?\"</span>,\n    <span class=\"hljs-attr\">\"parameters\"</span>: {\n        <span class=\"hljs-attr\">\"bookmaker\"</span>: <span class=\"hljs-literal\">null</span>\n    }\n}\n</code></pre>\n<h3 id=\"a-few-things\">A few things</h3>\n<p>I may have not get the point of using endpoints as channels and did not used them. It&#39;s actually useful when you&#39;re not using LUIS but as I was using it for every request, I did not have to use channels.</p>\n<h2 id=\"screenshots-of-final-result\">Screenshots of final result</h2>\n<p><img src=\"/dist/bot1.png\" alt=\"Facebook bot 1\">\n<img src=\"/dist/bot2.png\" alt=\"Facebook bot 2\">\n<img src=\"/dist/bot3.png\" alt=\"Facebook bot 3\"></p>\n<p>You may find the repository on my GitHub account <a href=\"https://github.com/gjuchault/demoDay-2016-05-13\">here</a>.</p>\n","title":"Using Microsoft Bot and LUIS","categories":["js","ai"],"date":"May 13, 2016","fullDate":"2016-05-13T00:00:00.000Z","excerpt":"<p>During my internship in <a href=\"http://bettercollective.com\">BetterCollective</a> I&#39;ve had the chance to try out <a href=\"https://dev.botframework.com/\">Microsoft Bot</a> during a demo day —a day where everyone can try out anything and make a demo at the end of they day—. I also used <a href=\"https://luis.ai\">LUIS</a> to recognize sentences.</p>","words":747},{"body":"<p>Some time ago I created a small library called <a href=\"https://github.com/gjuchault/fuzzyjs\">fuzzyjs</a>. The goal was to have a simple browser script that filters an array based on a string that would make a fuzzy filter/search (similar to what you have in Sublime Text : <em>ao</em> matches <em>About</em> and also <em>Add folder</em>).</p>\n<p>Since this project got it&#39;s small success (80 stars, and even a port in Go) I decided to rewrite it from scratch using what I learnt since : ES2015/Babel, UMD to support both the browser and node, Mocha for testing, Travis-CI, Istanbul, etc.</p>\n<p>Here is a small tutorial.</p>\n<h2 id=\"project-structure\">Project structure</h2>\n<p>First things first, you need an empty directory to start your nice library. Create a package.json (using <code>npm init</code>) so you have a <em>package.json</em> ready.</p>\n<p>Then you can create an optional <em>.editorconfig</em>, a <em>.eslintrc</em>, a <em>LICENSE</em> and a <em>README.md</em>.</p>\n<p>Then you can create directories <em>test</em> and <em>src</em>. In <em>test</em> you will place all your mocha files. In the <em>src</em> you will put your library file. If you need more than one file, consider using an <em>index.js</em> file that will require all the other files and export what you want. Be sure that your main file is set correctly in your package.json file (<code>&quot;main&quot;: &quot;build/index.js&quot;</code> for example).</p>\n<p>We will build our <em>src</em> directory in a <em>build</em> directory (you can also choose <em>dist</em> or <em>lib</em> of course).</p>\n<p>So the next step will be to create the <em>.gitignore</em> file :</p>\n<pre><code class=\"hljs sh\">npm-debug.log\ncoverage/\nnode_modules/\n</code></pre>\n<p>I choose to not ignore the build directory so that people can install and use the library with git. But this is up to you.</p>\n<p>We can then start to install our dev modules :</p>\n<pre><code class=\"hljs sh\">npm install --save-dev babel-cli babel-preset-es2015 babel-istanbul\nnpm install --save-dev coveralls mocha\n</code></pre>\n<p><em>Note: as my fuzzy library use <code>Object.assign</code> I also installed <code>babel-plugin-transform-object-assign</code></em>.</p>\n<h2 id=\"es2015-babel\">ES2015 : Babel</h2>\n<p>This has been written when Babel was at version 6. First we need to create a <em>.babelrc</em> file at the directory&#39;s root :</p>\n<pre><code class=\"hljs json\">{\n    <span class=\"hljs-attr\">\"plugins\"</span>: [<span class=\"hljs-string\">\"transform-object-assign\"</span>],\n    <span class=\"hljs-attr\">\"presets\"</span>: [<span class=\"hljs-string\">\"es2015\"</span>]\n}\n</code></pre>\n<p>In the <em>package.json</em> we need a <code>build</code> script. This will be as simple as :</p>\n<pre><code class=\"hljs json\">{\n    ...\n    &quot;scripts&quot; : {\n        &quot;build&quot;: &quot;babel -d build/ src/&quot;\n    }\n    ...\n}\n</code></pre>\n<p>From now on, if you start <code>npm run build</code> you should have something like that :</p>\n<pre><code class=\"hljs sh\">➜  fuzzyjs git:(master) npm run build\n\n&gt; fuzzyjs@1.0.4 build /home/gabriel/Workspace/fuzzyjs\n&gt; babel <span class=\"hljs-_\">-d</span> build/ src/\n\nsrc/fuzzy.js -&gt; build/fuzzy.js\n➜  fuzzyjs git:(master) ✗\n</code></pre>\n<h2 id=\"testing-mocha-istanbul\">Testing : Mocha &amp; Istanbul</h2>\n<p>In your <em>test</em> directory, you can write as many test files as you want. Using mocha, this will be as simple as something closed to :</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> assert <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'assert'</span>;\n<span class=\"hljs-keyword\">import</span> fuzzy <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'../src'</span>;\n\ndescribe(<span class=\"hljs-string\">'fuzzyjs'</span>, () =&gt; {\n    it(<span class=\"hljs-string\">'should be a nice library'</span>, () =&gt; {\n        assert.equal(<span class=\"hljs-number\">1</span>, <span class=\"hljs-number\">1</span>);\n    });\n});\n</code></pre>\n<p>The interesting fact here is : we use ES2015 to write tests too.</p>\n<p>Based with that we will need a Mocha test. But, we will also use istanbul to have a nice code coverage. Here is what the test command should look like :</p>\n<pre><code class=\"hljs json\">{\n    ...\n    &quot;scripts&quot; : {\n        &quot;build&quot;: &quot;babel -d build/ src/&quot;,\n        &quot;test&quot;: &quot;babel-node ./node_modules/.bin/babel-istanbul cover ./node_modules/.bin/_mocha -- --sort --bail&quot;\n    }\n    ...\n}\n</code></pre>\n<p>Let me explain a bit this test command.</p>\n<ol>\n<li>First it will use <code>babel-node</code>. This is similar to <code>node</code> command but babel will be included so you can use <code>babel-node</code> on ES2015 files. The only thing is that this is a bit slow. That&#39;s why we only use it for testing.</li>\n<li>Then we use <code>babel-istanbul</code> which is a small script similar to <code>babel-node</code>. It&#39;s just <code>istanbul</code> but babel-aware.</li>\n<li>Then we call the <code>_mocha</code> executable. Not <code>mocha</code> as this is a small executable that forks <code>_mocha</code> (we don&#39;t want a forked process).</li>\n<li>Then we pass additional arguments to mocha using <code>--</code> (this is equivalent to : what will follow is arguments). Theses arguments are <code>--sort</code> (so your test suite is sorted by file name) and <code>--bail</code> (which will stop as soon as a test does not pass).</li>\n</ol>\n<p>If you start <code>npm test</code> you should see something like :</p>\n<pre><code class=\"hljs sh\">➜  fuzzyjs git:(master) ✗ npm <span class=\"hljs-built_in\">test</span>\n\n&gt; fuzzyjs@1.0.4 <span class=\"hljs-built_in\">test</span> /home/gabriel/Workspace/fuzzyjs\n&gt; babel-node ./node_modules/.bin/babel-istanbul cover ./node_modules/.bin/_mocha -- --sort --bail\n\n\n\n  fuzzyjs\n    default search\n      ✓ finds the right string and surrounds it with a span tag\n      ✓ should <span class=\"hljs-built_in\">return</span> the full <span class=\"hljs-built_in\">set</span> without query\n    custom surrounding tag\n      ✓ finds the right string and surrounds it with a span tag\n    <span class=\"hljs-keyword\">case</span> sensitive search\n      ✓ finds only the lower <span class=\"hljs-keyword\">case</span> letter\n      ✓ finds only the upper <span class=\"hljs-keyword\">case</span> letter\n\n\n  5 passing (14ms)\n\n=============================================================================\nWriting coverage object [/home/gabriel/Workspace/fuzzyjs/coverage/coverage.json]\nWriting coverage reports at [/home/gabriel/Workspace/fuzzyjs/coverage]\n=============================================================================\n\n=============================== Coverage summary ===============================\nStatements   : 100% ( 36/36 ), 2 ignored\nBranches     : 100% ( 22/22 ), 4 ignored\nFunctions    : 100% ( 4/4 )\nLines        : 100% ( 36/36 )\n================================================================================\n</code></pre>\n<p>Which is so pretty.</p>\n<h2 id=\"travis-ci\">Travis-CI</h2>\n<p><a href=\"https://travis-ci.org/\">Travis-CI</a> is one of the most used continuous integration service. It&#39;s free for open-source. Use it all the time.</p>\n<p>Once you&#39;re logged using your GitHub account, start watching your repository. It will not work until you&#39;ve added the <em>.travis.yml</em> (that I will describe below) and push it.</p>\n<p>The next step is : how I make Travis know how to install the library and test it. That is done using the <em>.travis.yml</em> file. Create an empty file at your repository&#39;s root :</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">node_js</span>\n<span class=\"hljs-attr\">sudo:</span> <span class=\"hljs-literal\">false</span>\n<span class=\"hljs-attr\">node_js:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">'5'</span>\n<span class=\"hljs-attr\">install:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span>\n<span class=\"hljs-attr\">script:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">test</span>\n</code></pre>\n<p><code>language</code> is of course what language it uses, <code>sudo: false</code> is a parameter to tell Travis : I don&#39;t need sudo, so you can use Docker and maker faster builds. <code>node_js</code> array is which version you want to install (you can add multiple ones to test on node v4, iojs, or node v0.12).</p>\n<p>The <code>install</code> array is the list of commands you want Travis to run before it&#39;s ready to test. Travis already clone your repository and <code>cd</code> in it. The only thing needed here is <code>npm install</code>.</p>\n<p>The <code>script</code> array is your test suite. If one of this command fails, Travis will consider your commit failed. You could add <code>npm run lint</code> or <code>npm run minify</code> here for example, if you want your build to be linted before merged. Here I only test build, minify and the test suite here.</p>\n<h2 id=\"coveralls\">Coveralls</h2>\n<p>To get some nice code coverage report, you can either take your browser and open file <em>coverage/lcov-report/index.html</em> or you can start using <a href=\"https://coveralls.io/\">Coveralls</a>. Coveralls is a nice tool (free for open-source) that integrates well with github and will watch your pull requests, commits etc. to show the coverage similarly to the lcov-report. The cool thing here is that you can use <a href=\"https://github.com/nvie/gitflow\">Git Flow</a> or <a href=\"https://guides.github.com/introduction/flow/index.html\">GitHub Flow</a> and, before merging your request, ensure every test passes (that&#39;s Travis-CI task) and that your coverage isn&#39;t hurt (that&#39;s Coveralls).</p>\n<p>Coveralls is pretty easy to use. Once you&#39;re logged using GitHub, start watching your repository.\nCoveralls works with Travis well. We&#39;re going to add a small npm script for Coveralls, that will only be used with Travis :</p>\n<pre><code class=\"hljs json\">{\n    ...\n    &quot;scripts&quot; : {\n        &quot;build&quot;: &quot;babel -d build/ src/&quot;,\n        &quot;test&quot;: &quot;babel-node ./node_modules/.bin/babel-istanbul cover ./node_modules/.bin/_mocha -- --sort --bail&quot;,\n        &quot;coveralls&quot;: &quot;cat ./coverage/lcov.info | coveralls&quot;\n    }\n    ...\n}\n</code></pre>\n<p>This only takes the istanbul lcov report and sends it to coveralls. It will only work on Travis. If you start this command from your terminal, you will have an error similar to :</p>\n<pre><code class=\"hljs json\">Bad response: 422 {&quot;message&quot;:&quot;Couldn&#39;t find a repository matching this job.&quot;,&quot;error&quot;:true}\n</code></pre>\n<p>So how can we take this to Travis ? In the <em>.travis.yml</em> file, add the following lines :</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">after_script:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">coveralls</span>\n</code></pre>\n<p>Once the tests has been made in Travis, it&#39;ll run the coveralls. There coveralls will know that the travis build to be covered is this one, and it will display on the website the results of the tests, and of course the coverage.</p>\n<h2 id=\"npm\">NPM</h2>\n<p>Now it&#39;s time to publish on NPM. You will need an account on the website, and you will need to set up your npm to log in. In the terminal you can use this command :</p>\n<pre><code class=\"hljs sh\">npm run adduser\n</code></pre>\n<p>This will register to npm and create a <em>~/.npmrc</em> file. If you already have an account, this will just log in.</p>\n<p>We want to make Travis publish for us. The thing is : on your npm package, you don&#39;t need the <em>src/</em> directory. This could be done using a <em>.npmignore</em> file, but as we already have a <em>.gitignore</em> file; npm will combine both of them. If you try to put <em>build/</em> in the <em>.gitignore</em> and <em>src/</em> in <em>.npmignore</em>, when installing your package you will see that you will have none of them.</p>\n<p>That is fixable in two ways: either you make a <code>prepublish</code> script that do <code>npm run build</code> and <code>rm -rf*src/*. Or you use Travis</code>before_deploy` to do the same thing.</p>\n<p>I like the Travis way.</p>\n<p>Append this to your <em>.travis.yml</em> file:</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">before_deploy:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">rm</span> <span class=\"hljs-bullet\">-rf</span> <span class=\"hljs-string\">src/</span>\n</code></pre>\n<p>Next step : make Travis publish. I do love the <code>travis</code> executable (that you can get with <code>sudo gem install travis</code>). Start <code>travis setup npm</code>. It will ask for a few questions, and add nearly everything needed to your <em>.travis.yml</em> file.</p>\n<p>Nearly everything ? Yes. Travis is smart by default. Before publishing, it runs a <code>git stash</code> which will put your changes in a special folder so that you have a clean repo (similar to what you would have with <code>git checkout .</code>). Then it publishes. The fact is : stashing the changes will restore the <em>src/</em> directory and remove the <em>build/</em> one. So we need to explicitly disable the stashing part.</p>\n<p>This can be done by addind <code>skip_cleanup: true</code> in the deploy part of your travis file:</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-string\">...</span>\n<span class=\"hljs-attr\">deploy:</span>\n<span class=\"hljs-attr\">  skip_cleanup:</span> <span class=\"hljs-literal\">true</span>\n  <span class=\"hljs-string\">...</span>\n</code></pre>\n<p>When you want to make a PR, or just deploy a new version, update your package.json&#39;s version field (use <a href=\"http://semver.org/\">semver</a>). Commit, and push. Travis will test, and deploy if everything is okay. If you go for a pull request, be ready to get amazed by GitHub/Travis/Coveralls stack :</p>\n<p><img src=\"/dist/githubTravisCoveralls.png\" alt=\"GitHub Travis Coveralls\"></p>\n<p>Final files:\n<em>package.json</em></p>\n<pre><code class=\"hljs json\">{\n  <span class=\"hljs-attr\">\"name\"</span>: <span class=\"hljs-string\">\"fuzzyjs\"</span>,\n  <span class=\"hljs-attr\">\"version\"</span>: <span class=\"hljs-string\">\"1.0.4\"</span>,\n  <span class=\"hljs-attr\">\"description\"</span>: <span class=\"hljs-string\">\"Fuzzy.js is a fuzzy search algorithm in javascript\"</span>,\n  <span class=\"hljs-attr\">\"main\"</span>: <span class=\"hljs-string\">\"build/fuzzy.js\"</span>,\n  <span class=\"hljs-attr\">\"directories\"</span>: {\n    <span class=\"hljs-attr\">\"test\"</span>: <span class=\"hljs-string\">\"test\"</span>\n  },\n  <span class=\"hljs-attr\">\"dependencies\"</span>: {},\n  <span class=\"hljs-attr\">\"devDependencies\"</span>: {\n    <span class=\"hljs-attr\">\"babel-cli\"</span>: <span class=\"hljs-string\">\"^6.7.7\"</span>,\n    <span class=\"hljs-attr\">\"babel-istanbul\"</span>: <span class=\"hljs-string\">\"^0.8.0\"</span>,\n    <span class=\"hljs-attr\">\"babel-plugin-transform-object-assign\"</span>: <span class=\"hljs-string\">\"^6.5.0\"</span>,\n    <span class=\"hljs-attr\">\"babel-preset-es2015\"</span>: <span class=\"hljs-string\">\"^6.6.0\"</span>,\n    <span class=\"hljs-attr\">\"coveralls\"</span>: <span class=\"hljs-string\">\"^2.11.9\"</span>,\n    <span class=\"hljs-attr\">\"mocha\"</span>: <span class=\"hljs-string\">\"^2.4.5\"</span>,\n    <span class=\"hljs-attr\">\"uglify-js\"</span>: <span class=\"hljs-string\">\"^2.6.2\"</span>\n  },\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"build\"</span>: <span class=\"hljs-string\">\"babel -d build/ src/\"</span>,\n    <span class=\"hljs-attr\">\"coveralls\"</span>: <span class=\"hljs-string\">\"cat ./coverage/lcov.info | coveralls\"</span>,\n    <span class=\"hljs-attr\">\"minify\"</span>: <span class=\"hljs-string\">\"uglifyjs build/fuzzy.js -o build/fuzzy.min.js --source-map build/fuzzy.min.js.map\"</span>,\n    <span class=\"hljs-attr\">\"test\"</span>: <span class=\"hljs-string\">\"babel-node ./node_modules/.bin/babel-istanbul cover ./node_modules/.bin/_mocha -- --sort --bail\"</span>\n  },\n  <span class=\"hljs-attr\">\"repository\"</span>: {\n    <span class=\"hljs-attr\">\"type\"</span>: <span class=\"hljs-string\">\"git\"</span>,\n    <span class=\"hljs-attr\">\"url\"</span>: <span class=\"hljs-string\">\"git+https://github.com/gjuchault/fuzzyjs.git\"</span>\n  },\n  <span class=\"hljs-attr\">\"keywords\"</span>: [\n    <span class=\"hljs-string\">\"fuzzy\"</span>,\n    <span class=\"hljs-string\">\"searching\"</span>,\n    <span class=\"hljs-string\">\"algorithm\"</span>,\n    <span class=\"hljs-string\">\"fuzz\"</span>\n  ],\n  <span class=\"hljs-attr\">\"author\"</span>: <span class=\"hljs-string\">\"Gabriel Juchault &lt;gabriel.juchault@gmail.com&gt;\"</span>,\n  <span class=\"hljs-attr\">\"license\"</span>: <span class=\"hljs-string\">\"MIT\"</span>,\n  <span class=\"hljs-attr\">\"bugs\"</span>: {\n    <span class=\"hljs-attr\">\"url\"</span>: <span class=\"hljs-string\">\"https://github.com/gjuchault/fuzzyjs/issues\"</span>\n  },\n  <span class=\"hljs-attr\">\"homepage\"</span>: <span class=\"hljs-string\">\"https://github.com/gjuchault/fuzzyjs#readme\"</span>\n}\n</code></pre>\n<p><em>.travis.yml</em>:</p>\n<pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">language:</span> <span class=\"hljs-string\">node_js</span>\n<span class=\"hljs-attr\">sudo:</span> <span class=\"hljs-literal\">false</span>\n<span class=\"hljs-attr\">node_js:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">'5'</span>\n<span class=\"hljs-attr\">install:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">install</span>\n<span class=\"hljs-attr\">script:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">minify</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">test</span>\n<span class=\"hljs-attr\">after_script:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">coveralls</span>\n<span class=\"hljs-attr\">before_deploy:</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">npm</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">build</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">rm</span> <span class=\"hljs-bullet\">-rf</span> <span class=\"hljs-string\">src/</span>\n<span class=\"hljs-attr\">deploy:</span>\n<span class=\"hljs-attr\">  skip_cleanup:</span> <span class=\"hljs-literal\">true</span>\n<span class=\"hljs-attr\">  provider:</span> <span class=\"hljs-string\">npm</span>\n<span class=\"hljs-attr\">  email:</span> <span class=\"hljs-string\">gabriel.juchault@gmail.com</span>\n<span class=\"hljs-attr\">  api_key:</span>\n<span class=\"hljs-attr\">    secure:</span> <span class=\"hljs-string\">IJ8px2r0JaUm2jHVZkOrRKuc6d//bBbVVlvWC1/UCGzlN4sYando0rn0D1nHTOpQFur7yPXVQOipmxhrC6JOSjloUkZXptSksj39vVxGUaQRBR0FRf4mEHvUe5oH9QfgJLreqi3+c4LI2qC34uFPjzVPtlnBhvEa4x3gcm2TdWE=</span>\n<span class=\"hljs-attr\">  on:</span>\n<span class=\"hljs-attr\">    repo:</span> <span class=\"hljs-string\">gjuchault/fuzzyjs</span>\n</code></pre>\n<p>Useful links :</p>\n<ul>\n<li><a href=\"https://docs.travis-ci.com/user/deployment/npm/\">Travis-CI guide on npm publishing</a></li>\n<li><a href=\"https://docs.npmjs.com/misc/developers\">NPM guide</a></li>\n<li><a href=\"https://coveralls.zendesk.com/hc/en-us\">Coveralls guide</a></li>\n</ul>\n","title":"Creating a cool NPM package using ES2015, Babel, Travis and Coveralls","categories":["js"],"date":"Apr 23, 2016","fullDate":"2016-04-23T00:00:00.000Z","excerpt":"<p>Some time ago I created a small library called <a href=\"https://github.com/gjuchault/fuzzyjs\">fuzzyjs</a>. The goal was to have a simple browser script that filters an array based on a string that would make a fuzzy filter/search (similar to what you have in Sublime Text : <em>ao</em> matches <em>About</em> and also <em>Add folder</em>).</p>","words":2033},{"body":"<p>For the last few months, I helped the <a href=\"http://robotikutt.github.io/\">RobotikUTT</a> organization to create its future robot that it will present to the next <a href=\"http://www.planete-sciences.org/robot/?section=pages&amp;pageid=79\">Robotics French Cup</a>.</p>\n<p>There&#39;s a few people in the organisation, but I mainly worked with Axel Mousset (project&#39;s leader) on three topics : pathfinding, IA &amp; intracommunication.</p>\n<p>The robot uses mainly C++ and JavaScript.</p>\n<h2 id=\"pathfinding\">Pathfinding</h2>\n<p>My first job was to create a Node module that would make a simple pathfinding over a bitmap. There are a lot of plugins already doing it well.\nThe nuance here is that the plugin had to be performant (that means in C++), and supports everything we can expect from an advanced pathfinding library :</p>\n<ul>\n<li>Use a heap to optimize the lowest-cost finding operation</li>\n<li>Avoid reinspecting the same node</li>\n<li>Path simplification (8-directions)</li>\n</ul>\n<p>I did not used the <a href=\"https://en.wikipedia.org/wiki/Jump_point_search\">Jump Point Search</a> as it does not support avoiding corner crossing.</p>\n<h3 id=\"heap\">Heap</h3>\n<p>When I first looked into <a href=\"https://github.com/qiao/PathFinding.js\">PathFinding.js</a> (which I&#39;ve heavily inspired my library of); I looked for an equivalent to the <a href=\"https://github.com/qiao/heap.js\">heap</a> node module.\nActually there is two ways of making a heap queue in C++ :</p>\n<ol>\n<li>Use a classic vector and call <code>make_heap</code>, <code>push_heap</code> etc.</li>\n<li>Use a <code>priority_queue</code> that will do all the job for you</li>\n</ol>\n<p>To compare one node to another and sort it, the priority queue needs a class with <code>()</code> operator overloaded :</p>\n<pre><code class=\"hljs cpp\"><span class=\"hljs-keyword\">bool</span> HeapCompare_f::<span class=\"hljs-keyword\">operator</span>() (Node* x, Node* y) {\n    <span class=\"hljs-keyword\">return</span> x-&gt;f &gt; y-&gt;f;\n}\n</code></pre>\n<p>Create your priority_queue like that :</p>\n<pre><code class=\"hljs cpp\"><span class=\"hljs-comment\">// Node* is the item type, vector&lt;Node*&gt; the list type, and HeapCompare_f our comparison</span>\npriority_queue&lt;Node*, <span class=\"hljs-built_in\">vector</span>&lt;Node*&gt;, HeapCompare_f&gt; openList;\n</code></pre>\n<h3 id=\"reinspecting\">Reinspecting</h3>\n<p>To avoid any reinspection, two properties have been added to the Node : <code>closed</code> and <code>opened</code>.\nWhen a neighbour is about to be added to the node list, stop if he has already been in the node list.\nIf it&#39;s not, put <code>opened</code> to true. When getting the next node on the list, if any of its neighbours has <code>closed</code> to true, pass it.\nThis way, you can avoid getting at least avoid the parent one, and every one that has already been seed.\nThis is a major optimization to A*.</p>\n<h3 id=\"path-simplification\">Path simplification</h3>\n<p>I did have problems with the simplification algorithm already in PathFinding.js. I decided to create my own.</p>\n<p>Basically, compare every node to the next one, and if there is a path change, save the node, and change the actual direction.\nAs the path is starting from the target node (retrieve every parent from the target node until the first node), the list\nshould be reversed (in the backtrace function : <code>reverse(path.begin(), path.end());</code>).\nHere is what it looks like :</p>\n<pre><code class=\"hljs cpp\"><span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-keyword\">int</span>&gt;&gt; smoothenPath(<span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-keyword\">int</span>&gt;&gt;* path) {\n    <span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-keyword\">int</span>&gt;&gt; newPath(path-&gt;size(), <span class=\"hljs-built_in\">vector</span>&lt;<span class=\"hljs-keyword\">int</span>&gt;(<span class=\"hljs-number\">2</span>, <span class=\"hljs-number\">0</span>));\n\n    newPath[<span class=\"hljs-number\">0</span>] = path-&gt;at(<span class=\"hljs-number\">0</span>);\n    <span class=\"hljs-keyword\">int</span> l = <span class=\"hljs-number\">1</span>;\n\n    change change = CHANGE_UNKNOWN;\n\n    <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">unsigned</span> <span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">1</span>; i &lt; path-&gt;size(); ++i) {\n        <span class=\"hljs-keyword\">int</span> cmpX = (*path)[i - <span class=\"hljs-number\">1</span>][<span class=\"hljs-number\">0</span>];\n        <span class=\"hljs-keyword\">int</span> cmpY = (*path)[i - <span class=\"hljs-number\">1</span>][<span class=\"hljs-number\">1</span>];\n        <span class=\"hljs-keyword\">int</span> pX   = (*path)[i][<span class=\"hljs-number\">0</span>];\n        <span class=\"hljs-keyword\">int</span> pY   = (*path)[i][<span class=\"hljs-number\">1</span>];\n\n        <span class=\"hljs-keyword\">if</span> (change == CHANGE_UNKNOWN) {\n            <span class=\"hljs-keyword\">if</span> (cmpX == pX) {\n                change = CHANGE_Y;\n            } <span class=\"hljs-keyword\">else</span> {\n                <span class=\"hljs-keyword\">if</span> (cmpY != pY) {\n                    <span class=\"hljs-comment\">// Both change =&gt; diagonal</span>\n                    <span class=\"hljs-keyword\">if</span> (pY &gt; cmpY &amp;&amp; pX &gt; cmpX) {  change = CHANGE_SE; }\n                    <span class=\"hljs-keyword\">if</span> (pY &gt; cmpY &amp;&amp; pX &lt; cmpX) { change = CHANGE_SW; }\n                    <span class=\"hljs-keyword\">if</span> (pY &lt; cmpY &amp;&amp; pX &gt; cmpX) { change = CHANGE_NE; }\n                    <span class=\"hljs-keyword\">if</span> (pY &lt; cmpY &amp;&amp; pX &lt; cmpX) { change = CHANGE_NW; }\n                } <span class=\"hljs-keyword\">else</span> {\n                    change = CHANGE_X;\n                }\n            }\n        }\n\n        <span class=\"hljs-keyword\">bool</span> hasChange = <span class=\"hljs-literal\">false</span>;\n        <span class=\"hljs-keyword\">if</span> (change == CHANGE_Y &amp;&amp; !(cmpX == pX &amp;&amp; cmpY != pY)) {\n            hasChange = <span class=\"hljs-literal\">true</span>;\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (change == CHANGE_X &amp;&amp; !(cmpY == pY &amp;&amp; cmpX != pX)) {\n            hasChange = <span class=\"hljs-literal\">true</span>;\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (change == CHANGE_SE &amp;&amp; !(pY &gt; cmpY &amp;&amp; pX &gt; cmpX)) {\n            hasChange = <span class=\"hljs-literal\">true</span>;\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (change == CHANGE_SW &amp;&amp; !(pY &gt; cmpY &amp;&amp; pX &lt; cmpX)) {\n            hasChange = <span class=\"hljs-literal\">true</span>;\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (change == CHANGE_NE &amp;&amp; !(pY &lt; cmpY &amp;&amp; pX &gt; cmpX)) {\n            hasChange = <span class=\"hljs-literal\">true</span>;\n        } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (change == CHANGE_NW &amp;&amp; !(pY &lt; cmpY &amp;&amp; pX &lt; cmpX)) {\n            hasChange = <span class=\"hljs-literal\">true</span>;\n        }\n\n        <span class=\"hljs-keyword\">if</span> (hasChange) {\n            change = CHANGE_UNKNOWN;\n            newPath[l] = (*path)[i - <span class=\"hljs-number\">1</span>];\n            ++l;\n        }\n    }\n\n    newPath[l] = path-&gt;at(path-&gt;size() - <span class=\"hljs-number\">1</span>);\n\n    newPath.resize(l + <span class=\"hljs-number\">1</span>);\n\n    <span class=\"hljs-keyword\">return</span> newPath;\n}\n</code></pre>\n<h2 id=\"ia\">IA</h2>\n<p>My second job was to create sequences of promises, that should execute in sequence.</p>\n<p>Here is what the API looks like for Sequences :</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">let</span> seq = <span class=\"hljs-keyword\">new</span> Sequence();\n\nseq\n    .next(<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> =&gt;</span> {\n        <span class=\"hljs-keyword\">return</span> promise;\n    })\n    .delay(<span class=\"hljs-number\">500</span>)\n    .next(<span class=\"hljs-function\"><span class=\"hljs-params\">()</span> =&gt;</span> {\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {\n            resolve();\n        });\n    })\n    .start();\n\n<span class=\"hljs-comment\">// Events in seq : started, next, error, stoped, finished</span>\n</code></pre>\n<p>This is used by the IA. By default the robot has some tasks to do, and it will follow them in order to complete its goals.\nBut if something is wrong, then the robot has to evaulate where he is, where he can go and how many points that can make him win.\nThen a ratio <code>pointsEarned / distance</code> is calculated for every task, and then execute the task with the best score.</p>\n<h2 id=\"intracommunication\">Intracommunication</h2>\n<p>The last thing I&#39;ve been working on these days was the communication between the main computer (a <a href=\"http://beagleboard.org/bone\">Beaglebone</a>), and the multiple cards (<a href=\"https://www.arduino.cc/en/Main/ArduinoBoardNano\">Arduino Nano</a>, for example).\nThe communication is done by two ways : either by <a href=\"https://fr.wikipedia.org/wiki/Controller_Area_Network\">CANbus</a> or with <a href=\"https://fr.wikipedia.org/wiki/UART\">UART</a>. CANbus already has its protocol but UART does not.</p>\n<p>The solution was making a modulable communication library with predefined « packets » that would be encoded in the less space possible. Here is was the final result looks like :</p>\n<pre><code class=\"hljs js\"><span class=\"hljs-keyword\">import</span> communication <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./communication'</span>;\n<span class=\"hljs-keyword\">let</span> com    = <span class=\"hljs-keyword\">new</span> communication.transports.UART(<span class=\"hljs-literal\">null</span>);\n<span class=\"hljs-keyword\">let</span> buffer = com.serializer(<span class=\"hljs-keyword\">new</span> communication.protocol.TestPacket(<span class=\"hljs-number\">60</span>)).raw;\n\n<span class=\"hljs-built_in\">console</span>.log(com.parse(buffer));\n\n<span class=\"hljs-keyword\">let</span> com2    = <span class=\"hljs-keyword\">new</span> communication.transports.CANBus(<span class=\"hljs-literal\">null</span>);\n<span class=\"hljs-keyword\">let</span> buffer2 = com2.serializer(<span class=\"hljs-keyword\">new</span> communication.protocol.TestPacket(<span class=\"hljs-number\">60</span>)).raw;\n\n<span class=\"hljs-built_in\">console</span>.log(com2.parse(communication.protocol.TestPacket, buffer2));\n</code></pre>\n<p>Of course, the API provides methods to send packets, but most of the job was to serialize and parse buffers.\nIn fact I based my work on something similar to CANBus in the UART serializer :</p>\n<ol>\n<li>Data size encoded in one or two byte (depending on the first bit — so encoded on 7 or 15 bits)</li>\n<li>A « command id » is put (that identifies the packet type) (one byte)</li>\n<li>The data buffer</li>\n<li>A XOR checksum</li>\n</ol>\n<p>The serializer just writes values on the buffer. Packets are defined by JSON files, parsed from the <code>index.js</code> file.\nThe parser create classes for every JSON files. This is made by JavaScript reflexion :</p>\n<pre><code class=\"hljs js\">fs\n    .readdirSync(__dirname)\n    .filter(<span class=\"hljs-function\"><span class=\"hljs-params\">file</span> =&gt;</span> file.slice(<span class=\"hljs-number\">-5</span>) === <span class=\"hljs-string\">'.on'</span>)\n    .map(<span class=\"hljs-function\"><span class=\"hljs-params\">file</span> =&gt;</span> <span class=\"hljs-built_in\">require</span>(path.join(__dirname, file)))\n    .forEach(<span class=\"hljs-function\"><span class=\"hljs-params\">protocol</span> =&gt;</span> {\n        packets[protocol.name] = <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> </span>{\n            ...\n        };\n    });\n</code></pre>\n<p>And a packets looks like this :</p>\n<pre><code class=\"hljs js\">{\n    <span class=\"hljs-string\">\"name\"</span>: <span class=\"hljs-string\">\"TestPacket\"</span>,\n    <span class=\"hljs-string\">\"id\"</span>  : <span class=\"hljs-number\">0</span>,\n    <span class=\"hljs-string\">\"data\"</span>: {\n        <span class=\"hljs-string\">\"foo\"</span>: {\n            <span class=\"hljs-string\">\"type\"</span>: <span class=\"hljs-string\">\"int8\"</span>,\n            <span class=\"hljs-string\">\"default\"</span>: <span class=\"hljs-number\">-1</span>\n        },\n        ...\n}\n</code></pre>\n<h2 id=\"links\">Links</h2>\n<p>Robot repository : <a href=\"https://github.com/RobotikUTT/eurobot-core/tree/2016\">2016 branch</a> or <a href=\"https://github.com/RobotikUTT/eurobot-core/tree/2016-com\">2016-com branch</a> with the communication module.</p>\n<p>pathfindingjs repository : <a href=\"https://github.com/gjuchault/pathfindingjs\">github</a></p>\n<p>Scheduler/Sequence repository : <a href=\"https://github.com/gjuchault/schedulerjs\">github</a></p>\n","title":"RobotikUTT","categories":["utt","robotics"],"date":"Jan 29, 2016","fullDate":"2016-01-29T00:00:00.000Z","excerpt":"<p>For the last few months, I helped the <a href=\"http://robotikutt.github.io/\">RobotikUTT</a> organization to create its future robot that it will present to the next <a href=\"http://www.planete-sciences.org/robot/?section=pages&amp;pageid=79\">Robotics French Cup</a>.</p>","words":1277},{"body":"<p>During one week-end (11/20 and 11/21), we participed (along with four members of the robotics team) to an electronics hackathon. The subject was « Embedded systems serving the environment ».</p>\n<p>We were five to participate : two developpers (pretty good in electronics), one project manager/math guy, one specialized in electronic and me (development). Concurrent teams where coming from all over the France, and a majority of the teams were from the hosting school.</p>\n<h2 id=\"provided-hardware\">Provided hardware</h2>\n<p>The organizers provided us WiFi of course, a Raspberry Pi and an AIM Kit (similar to RPi with a touchscreen).  They also had a few activities to let us entertain during the week-end (food, foosball, etc.). One of the partner (EDF - which provides electricity/gas all over the France) allowed us to use its Open Data website. The API (REST/JSON) contained some relevant informations.</p>\n<h2 id=\"our-project\">Our project</h2>\n<p>We worked on a proof of concept called « Flux ». The concept was the making of a small box that everyone could buy and put on its roof. This box was supposed to gather solar exposition and wind exposition. Each day, the module would send data to a server. After a year, a report was sent by email with a precise estimation on the rentability of the installation of a solar panel and/or a wind turbine.</p>\n<p>What we liked in this idea is that you could use this product either for a personal use, or (if you&#39;re managing a city/state/etc. - any collectivity) you could buy a few boxes and put them all over the city/state/etc.. After a year, you could see what would be the benefits for your people to use solar panels/wind turbines.</p>\n<p>The RPi was used to make the controller (gathering the data/convert lumens to kWh and con convert m/s to kWh and sending the data).\nThe AIM Kit was used to simulate the data source : sun/wind (two sliders and a send button).</p>\n<p><img src=\"/dist/enseack.png\" alt=\"Flux, out project\"></p>\n<h2 id=\"what-i-did\">What I did</h2>\n<p>Actually, I got the base idea (inspired by Google Sunroof). I also created the server and a admin panel that would show a realtime map of every module installed. I also helped on the math part (lumens -&gt; kWh and m/s -&gt; kWh). My friends made electronics, the client side (on the RPi), the math and the presentation of the project to the jury.</p>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>The event was great. Our team was solid, we did some pretty good job. Even if we didn&#39;t win anything; I really enjoyed the event.</p>\n","title":"Enseack","categories":["utt","robotics"],"date":"Dec 21, 2015","fullDate":"2015-12-21T00:00:00.000Z","excerpt":"<p>During one week-end (11/20 and 11/21), we participed (along with four members of the robotics team) to an electronics hackathon. The subject was « Embedded systems serving the environment ».</p>","words":417}]